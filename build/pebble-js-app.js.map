{"version":3,"sources":["webpack/bootstrap 0ec94abdda03638dab12","/home/erik/.pebble-sdk/SDKs/4.3/sdk-core/pebble/common/include/_pkjs_shared_additions.js","./src/pkjs/index.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;ACtCA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA,EAAC;;;;;;;ACnBD;AACA;;AAEA,6BAA4B;;;AAG5B;AACA;AACA,wBAAuB;AACvB;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,4BAA2B,qBAAqB;AAChD;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,8BAA6B,mBAAmB;AAChD,MAAK;AACL;AACA,8BAA6B,qBAAqB;AAClD;AACA;;AAEA;AACA;AACA;AACA,4BAA2B,qBAAqB;AAChD;;AAEA,4BAA2B,qBAAqB;AAChD;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAC","file":"pebble-js-app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 0ec94abdda03638dab12","(function(p) {\n  if (!p === undefined) {\n    console.error('Pebble object not found!?');\n    return;\n  }\n\n  // Aliases:\n  p.on = p.addEventListener;\n  p.off = p.removeEventListener;\n\n  // For Android (WebView-based) pkjs, print stacktrace for uncaught errors:\n  if (typeof window !== 'undefined' && window.addEventListener) {\n    window.addEventListener('error', function(event) {\n      if (event.error && event.error.stack) {\n        console.error('' + event.error + '\\n' + event.error.stack);\n      }\n    });\n  }\n\n})(Pebble);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// /home/erik/.pebble-sdk/SDKs/4.3/sdk-core/pebble/common/include/_pkjs_shared_additions.js\n// module id = 1\n// module chunks = 0","var MEMOS_URL = \"https://notes.erimow.com/api/v1/memos\";\nvar MEMOS_TOKEN = \"eyJhbGciOiJIUzI1NiIsImtpZCI6InYxIiwidHlwIjoiSldUIn0.eyJuYW1lIjoiZXJpbW93IiwiaXNzIjoibWVtb3MiLCJzdWIiOiIxIiwiYXVkIjpbInVzZXIuYWNjZXNzLXRva2VuIl0sImlhdCI6MTc2NzcyNjAxM30.i3HuB3z-5pfgY1kJ3m9St7zHEi_VxrHNq2jykpZnMj8\";\n\nvar AUTO_TAGS = [\"#pebble\"]; // [\"#separate, #by, #commas, #for, #extra, #tags\"]\n\n\n/* ---------- APPMESSAGE KEYS (MUST MATCH C) ---------- */\nvar KEY_MEMO_CHUNK = 0;\nvar KEY_MEMO_DONE  = 1; // sent by C, not used here\nvar KEY_MEMO_OK    = 2;\nvar KEY_MEMO_FAIL  = 3;\n\n/* ---------- STATE ---------- */\nvar isSending = false;\n\n/* =========================================================\n * Memo parser\n * ========================================================= */\nfunction parseMemo(text) {\n  var tags = AUTO_TAGS.slice();\n  var content = text;\n\n  /* ---- Replace special commands ---- */\n  content = content.replace(/check box[\\s,.]*/gi, \"- [ ] \");\n  content = content.replace(/checkbox[\\s,.]*/gi, \"- [ ] \");\n  content = content.replace(/new line[\\s,.]*/gi, \"\\n\");\n  content = content.replace(/title big[\\s,.]*/gi, \"# \");\n  content = content.replace(/title medium[\\s,.]*/gi, \"## \");\n  content = content.replace(/title small[\\s,.]*/gi, \"### \");\n\n  /* ---- Extract spoken hashtags ---- */\n  var tagRegex = /hashtag\\s+(\\w+)/gi;\n  var match;\n  while ((match = tagRegex.exec(text)) !== null) {\n    tags.push(\"#\" + match[1].toLowerCase());\n  }\n\n  content = content.replace(tagRegex, \"\").trim();\n\n  return content + \"\\n\\n\" + tags.join(\" \");\n}\n\n/* =========================================================\n * AppMessage handler\n * ========================================================= */\nPebble.addEventListener(\"appmessage\", function (e) {\n  console.log(\"Memos: Raw payload:\", JSON.stringify(e.payload));\n\nvar chunk = e.payload[\"KEY_MEMO_CHUNK\"];\nif (typeof chunk !== \"string\") {\n  console.log(\"Memos: KEY_MEMO_CHUNK missing or not string\", chunk);\n  return;\n}\n\n  if (!e.payload || typeof e.payload[\"KEY_MEMO_CHUNK\"] !== \"string\") {\n    console.log(\"Memos: Invalid payload\");\n    return;\n  }\n\n  if (isSending) {\n    console.log(\"Memos: Already sending, ignoring\");\n    return;\n  }\n\n  var memoText = e.payload[\"KEY_MEMO_CHUNK\"];\n  console.log(\"Memos: Received memo:\", memoText);\n\n  isSending = true;\n\n  try {\n    var finalMemo = parseMemo(memoText);\n    sendMemo(finalMemo);\n  } catch (err) {\n    console.log(\"Memos: Parse error\", err);\n    isSending = false;\n    Pebble.sendAppMessage({ \"KEY_MEMO_FAIL\": 1 });\n  }\n});\n\n/* =========================================================\n * Send memo to Memos server\n * ========================================================= */\nfunction sendMemo(finalMemo) {\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"POST\", MEMOS_URL, true);\n  xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n  xhr.setRequestHeader(\"Authorization\", \"Bearer \" + MEMOS_TOKEN);\n\n  xhr.onload = function () {\n    isSending = false;\n\n    if (xhr.status >= 200 && xhr.status < 300) {\n      console.log(\"Memos: Sent successfully\");\n      Pebble.sendAppMessage({ \"KEY_MEMO_OK\": 1 });\n    } else {\n      console.log(\"Memos: Server error\", xhr.status);\n      Pebble.sendAppMessage({ \"KEY_MEMO_FAIL\": 1 });\n    }\n  };\n\n  xhr.onerror = function () {\n    isSending = false;\n    console.log(\"Memos: Network error\");\n    Pebble.sendAppMessage({ \"KEY_MEMO_FAIL\": 1 });\n  };\n\n  xhr.send(JSON.stringify({ content: finalMemo }));\n}\n\n/* =========================================================\n * Lifecycle\n * ========================================================= */\nPebble.addEventListener(\"ready\", function () {\n  console.log(\"Memos: PebbleKit JS ready\");\n});\n\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pkjs/index.js\n// module id = 2\n// module chunks = 0"],"sourceRoot":""}